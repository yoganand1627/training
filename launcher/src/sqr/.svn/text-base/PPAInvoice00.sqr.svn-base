!---------------------------------------------------------------------------------------------------------
! Generated on Wed Mar 17 17:08:34 2010 by Hyperion SQR Developer 8.5.0.0.0.302
! Filename: D:\Reports\PPAInvoice00.sqr
! Format  : Tabular
! Username: CAPS
!---------------------------------------------------------------------------------------------------------

Begin-Setup
 Declare-Layout Default
  Orientation = Landscape
  Paper-Size = (Letter)
  Top-Margin    = 0.500 
  Bottom-Margin = 0.500 
  Left-Margin   = 0.500 
  Right-Margin  = 0.500 
  Line-Height = 1
  Char-Width  = 1
 End-Declare
 Declare-Procedure
  Before-Report = BRB_Report_Before
  After-Report = BRB_Report_After
  After-Page = BRB_After_Page
 End-Declare
End-Setup

Begin-Procedure BRB_Report_Before
 Alter-Report Heading-Size=168    ! combined report header - page header data
 Next-Listing
End-Procedure

Begin-Procedure BRB_Report_After
 Alter-Report Heading=None Footing=None
 New-Page
 Position (1,1)
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print 'Key' (223,6,0) Underline  Bold 
 Print 'Definitions' (15,5,0) Underline  Bold 
 Page-Number (474,668) '' ' of '
 Last-Page (474,695) 
 Alter-Printer Font=4 Point-Size=8    ! [SQR.INI] 4=Arial,proportional
 Print 'Aprvl Status: invoice status regarding approval process.' (239,8,0) Underline  Bold 
 Print 'DPV - Disapproved' (270,21,30)
 Print 'RJA - Rejected Approval' (303,21,30)
 Print 'PAP - Pending Approval' (287,21,30)
 Print 'APV - Approved' (253,21,30)
 Print 'C - IV-E Adjustment' (253,341,30)
 Print 'Invoice Specific Adj.: Invoice Specific Adjustment type' (239,323,0) Underline  Bold 
 Print 'Y - Non IV-E Adjustment' (270,341,30)
 Print 'R - Recoupment' (287,341,30)
 Print 'N - Not Adjustment (the positive invoice relate to the recoupement invoice (R))' (303,341,30)
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print 'This report displays all adjustment invoices generated by any prior period adjustment batch that was run between a begin and end date (generation date from and to). The report requestor has the option to choose from a selection of report parameters to narrow the results returned. Parameters available include the following: region, county, resource ID, client ID, invoice type, phase, and adjustment type.' (33,13,144) Wrap 144 3 line-height=12 Keep-Top
 Print 'The results are sorted by county and client name/ID in alphabet ascending order. Multiple invoices for the same client are sorted by the original check number in descending order, original invoice ID in descending order, and adjustment invoice ID in descending order.' (167,13,144) Wrap 144 2 line-height=12 Keep-Top
 Print 'For adjustment type recoupment, if there is a positive invoice associated with the recoupment, it will be displayed as well. The positive invoice will have type N (Not Adjustment). Also note the positive invoice may be for a different region than the recoupment invoice. In order to display all associated invoices for the original invoice, do not specify region while choosing report parameters.' (82,13,144) Wrap 144 3 line-height=12 Keep-Top
 Print 'Adjustment invoice can be generated for invoices in Paid or Submitted status. For Submitted invoices, check date, number and amount have yet available. These display blank on the report.' (133,13,144) Wrap 144 2 line-height=12 Keep-Top
   Print-Direct printer=html '%%ResetBorder'
 Alter-Report Heading=Default
              Footing=Default
 Next-Listing
End-Procedure

! Supports a special heading on the first page, which combines the report
! header and the default page header into a single header only for that page,
! changing it back to the default page header for subsequent pages.
Begin-Procedure BRB_After_Page
 If #page-count <= 1
   Alter-Report Heading-Size=48   ! Revert to non-page-1 header size.
 End-If
End-Procedure

Begin-Program
 Position (1,1)
 Do Get_Input
 Do Master_Query
End-Program
Begin-Procedure Get_Input
! Required batch generation date from and t; validation jhandled by launch page
Input $dt_generation_from 'Enter Generation Date From* (MM/DD/YYYY)' MaxLen=10 Type=Date Format='MM/DD/YYYY'
Input $dt_generation_to 'Enter Generation Date To* (MM/DD/YYYY)' MaxLen=10 Type=Date Format='MM/DD/YYYY'

!Let $where_clause_generation_range = 'DT_INVO_CREATE_DATE >= to_date(' || $dt_generation_from || '(, ' || '''' || 'mm/dd/yyyy' || '''' || ')' 

! Optional inputs: region, county, person ID, resource ID, invoice adjustment indicator, invoice type, invoice phase
Input $cd_invo_region 'Invoice Region ' MaxLen=2  Type=Char
Input $cd_invo_county 'Invoice County ' MaxLen=3  Type=Char
Input $id_client 'Client ID' MaxLen=16  Type=Char
Input $id_resource 'Resource ID' MaxLen=16  Type=Char
Input $ind_invo_adj 'Invoice Specific Adjustment ' MaxLen=2  Type=Char
Input $cd_invo_type 'Invoice Type ' MaxLen=3  Type=Char
Input $cd_invo_phase 'Invoice Phase ' MaxLen=3  Type=Char

! Process optional inputs
If IsNull($cd_invo_region) or IsBlank($cd_invo_region) or ($cd_invo_region='0')
  Let $where_clause_region = '1 = 1'
  Let $region = 'All'
Else 
  Let $where_clause_region = 'INVOICE_ADJ.CD_INVO_REGION = ' || '''' || $cd_invo_region || ''''
  Let $region = $cd_invo_region
End-If

If IsNull($cd_invo_county) or IsBlank($cd_invo_county) or ($cd_invo_county='0')
  Let $where_clause_county = '2 = 2'
  Let $county = 'All'
Else 
  Let $where_clause_county = 'INVOICE_ADJ.CD_INVO_COUNTY = ' || '''' || $cd_invo_county || ''''
  Do Decode_County
End-If

If IsNull($id_client) or IsBlank($id_client) or ($id_client='0')
  Let $where_clause_client = '3 = 3'
  Let $client = 'All'
Else 
  Let $where_clause_client = 'PERSON_CLIENT.ID_PERSON = ' || $id_client
  Let $client = $id_client
End-If

If IsNull($id_resource) or IsBlank($id_resource) or ($id_resource='0')
  Let $where_clause_resource = '4 = 4'
  Let $resource = 'All'
Else 
  Let $where_clause_resource = 'CONTRACT.ID_RESOURCE = ' || $id_resource
  Let $resource = $id_resource
End-If

If IsNull($ind_invo_adj) or IsBlank($ind_invo_adj) or ($ind_invo_adj='0')
  !Let $where_clause_adj = 'CD_INVO_ADJUSTMENT_RB in (' || '''' || 'Y' || '''' || ',' || '''' || 'C' || '''' || ',' || '''' || 'R' || '''' || ')'
  Let $where_clause_adj = '7 = 7' ! we now include positive recoupment which shares the N indicator with the regular invoices.
  Let $adj = 'All Adjustments'
Else
  If $ind_invo_adj = 'R'
    Let $where_clause_adj ='INVOICE_ADJ.CD_INVO_ADJUSTMENT_RB in (' || '''' || 'R' || '''' || ',' || '''' || 'N' || '''' || ')'
  Else 
    Let $where_clause_adj = 'INVOICE_ADJ.CD_INVO_ADJUSTMENT_RB = ' || '''' || $ind_invo_adj || ''''
  End-If
    Do Decode_Invoice_Adj
End-If

If IsNull($cd_invo_type) or IsBlank($cd_invo_type) or ($cd_invo_type='0') or ($cd_invo_type = 'ALL')
  Let $where_clause_type = '5 = 5'
  Let $type = 'All'
Else 
  Let $where_clause_type = 'INVOICE_ADJ.CD_INVO_TYPE = ' || '''' || $cd_invo_type || ''''
  Do Decode_Invoice_Type
End-If

If IsNull($cd_invo_phase) or IsBlank($cd_invo_phase) or ($cd_invo_phase='0') or ($cd_invo_phase = 'ALL')
  Let $where_clause_phase = '6 = 6'
  Let $phase = 'All'
Else 
  Let $where_clause_phase = 'INVOICE_ADJ.CD_INVO_PHASE = ' || '''' || $cd_invo_phase || ''''
  Do Decode_invoice_phase
End-If

Let $where_clause_optional = $where_clause_region || ' and ' || $where_clause_county || ' and ' || $where_clause_client || ' and ' || $where_clause_resource || ' and ' || $where_clause_adj || ' and ' || $where_clause_type || ' and ' || $where_clause_phase
End-Procedure 
!  ----------------------------
Begin-Procedure Decode_Invoice_Adj
Let $ind_invo_adj_q = '''' || $ind_invo_adj || ''''
Begin-Select
decode &invo_Adj
  Move &invo_Adj to $adj
from codes_tables
where code_type = 'CINVADJT' and code = [$ind_invo_adj_q]
End-Select
End-Procedure
!  ----------------------------
Begin-Procedure Decode_Invoice_Type
Let $cd_invo_type_q = '''' || $cd_invo_type || ''''
Begin-Select
CINVTYPE.DECODE &invoType
 Move &invoType to $type
from CINVTYPE
where CINVTYPE.CODE = [$cd_invo_type_q] 
End-Select
End-Procedure
!  ----------------------------
Begin-Procedure Decode_Invoice_Phase
Let $cd_invo_phase_q = '''' || $cd_invo_phase || ''''
Begin-Select
CINVSRCH.DECODE &invoPhase
 Move &invoPhase to $phase
from CINVSRCH
where CINVSRCH.CODE = [$cd_invo_phase_q] 
End-Select
End-Procedure
!  ----------------------------
Begin-Procedure Decode_County
Let $cd_invo_county_q = '''' || $cd_invo_county || ''''
Begin-Select
decode &decode
 Move &decode to $county
from ccount
where code = [$cd_invo_county_q]
End-Select
End-Procedure
! ----------------------------
Begin-Procedure Calc_Report_Summary (#P1_ID_INVOICE, $adj_type, :#recoup_cnt, :#recoup_positive_cnt, :#recoup_negative_cnt, :#recoup_positive_total, :#recoup_negative_total, 
                                    :#rerate_cnt,  :#rerate_positive_cnt, :#rerate_negative_cnt, :#rerate_positive_total, :#rerate_negative_total)

! Sum all line item total for an invoice - note that this is done relying on the fact that all line items for an invoice have the same sign (all + or all -; by Susan Morgan)
Begin-Select
Sum(DELVRD_SVC_DTL.AMT_SVC_DTL_UNIT_RATE *  DELVRD_SVC_DTL.NBR_SVC_DTL_UNIT_QTY) &invoice_total
From  DELVRD_SVC_DTL
       Where ID_INVOICE = #P1_ID_INVOICE
End-Select
! Accumalate total and counts
if ($adj_type = 'Y' or $adj_type = 'C')
      add 1 to #rerate_cnt
      if &invoice_total > 0
           add &invoice_total to #rerate_positive_total
           add 1 to #rerate_positive_cnt
         else 
           add &invoice_total to #rerate_negative_total
           add 1 to #rerate_negative_cnt
      end-if
else 
      add 1 to #recoup_cnt
      if &invoice_total > 0
           add &invoice_total to #recoup_positive_total
           add 1 to #recoup_positive_cnt
         else 
           add &invoice_total to #recoup_negative_total
           add 1 to #recoup_negative_cnt
      end-if
end-if
End-Procedure


Begin-Procedure Master_Query
Let #_recoup_cnt = 0 
Let #_recoup_positive_cnt = 0  
Let #_recoup_negative_cnt = 0  
Let #_recoup_positive_total = 0  
Let #_recoup_negative_total = 0  
Let #_rerate_cnt = 0   
Let #_rerate_positive_cnt = 0  
Let #_rerate_negative_cnt = 0  
Let #_rerate_positive_total = 0  
Let #_rerate_negative_total = 0 

 Do CreateXML_ManifestFile
 Move 0 To #1ROW_COUNT
Begin-Select Distinct
!INVOICE_ADJ.ID_INVOICE &invo_ID2 
!INVOICE_ADJ.CD_INVO_ADJUSTMENT_RB &adj_type2

 Do Calc_Report_Summary(&invo_ID, &adj_type, #_recoup_cnt, #_recoup_positive_cnt, #_recoup_negative_cnt, #_recoup_positive_total, #_recoup_negative_total, 
                        #_rerate_cnt,  #_rerate_positive_cnt, #_rerate_negative_cnt, #_rerate_positive_total, #_rerate_negative_total)

 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
(1) &dummy () On-Break Set=1 Level=1 Print=Never
(decode ( CCOUNT.DECODE, '-None-', '-Multi-County-',  CCOUNT.DECODE  )) &county_header () On-Break Set=1 Level=2 Save=$prev_cnty Print=Never Before=Master_Querycounty_header_BeforeProc102 After=Master_Querycounty_header_AfterProc102
(PERSON_CLIENT.NM_PERSON_FULL || '           '  || PERSON_CLIENT.ID_PERSON) &client_name_ID () On-Break Set=1 Level=3 Save=$prev_client Print=Never Before=Master_Queryclient_name_ID_BeforeProc103 After=Master_Queryclient_name_ID_AfterProc103
 Graphic (1,48,672) Horz-Line 10 
INVOICE_ADJ.ID_INVOICE &invo_ID (19,50) Edit 999999999na
INVOICE_ADJ.CD_INVO_TYPE &type (19,103,3)
INVOICE_ADJ.CD_INVO_PHASE &phase (19,130,3)
CAPS_RESOURCE.ID_RESOURCE &res_ID (19,165) Edit 999999999na
INVOICE_ADJ.NBR_INVO_VID &vendor (19,344,7)
INVOICE_ADJ.DT_INVO_SUBMIT_DATE &submitted_dt (19,386) Edit MM/DD/YYYY
INVOICE_ADJ.ID_ORIG_REVERSAL_INV &org_invo_ID (19,443) Edit 999999999na
INVOICE_ADJ.DT_ADJ_INVO_PAID_CHECK &org_ck_dt (19,500) Edit MM/DD/YYYY
NM_RESOURCE &res_nm (19,220,22) Wrap 22 3 line-height=12 Keep-Top
INVOICE_ADJ.CD_INVO_APPROVED &aprvl (19,662,3)
INVOICE_ADJ.CD_INVO_ADJUSTMENT_RB &adj_type (19,696,2)
INVOICE_ORG.NBR_INVO_WARRANT &org_ck_num2 (19,556,10)
INVOICE_ORG.AMT_INVO_WARRANT &org_ck_amt (19,598) Edit 999999.99nu
 Next-Listing   ! Close up the wrapped columns
 Graphic (8,101,615) Horz-Line 5 
 Print 'Month' (23,101,10) Underline 
 Print 'Year' (23,144,10) Underline 
 Print 'From' (23,192,10) Underline 
 Print 'To' (23,234,10) Underline 
 Print 'Service' (23,272,10) Underline 
 Print 'Total' (23,661,10) Underline 
 Graphic (30,101,615) Horz-Line 5 
 Add 1 To #1ROW_COUNT
 Add 1 To #102ROW_COUNT
 Add 1 To #103ROW_COUNT
 Next-Listing  SkipLines=6 Need=49
 Do Line_Item(&invo_ID)
From  CCOUNT, INVOICE INVOICE_ADJ
,      INVOICE INVOICE_ORG, PERSON_ENC PERSON_CLIENT, CONTRACT
,      CAPS_RESOURCE, DELVRD_SVC_DTL DELVRD_SVC_DTL_ADJ
      Where CCOUNT.CODE = INVOICE_ADJ.CD_INVO_COUNTY
            And INVOICE_ADJ.ID_ORIG_REVERSAL_INV = INVOICE_ORG.ID_INVOICE
            And INVOICE_ADJ.ID_CONTRACT = CONTRACT.ID_CONTRACT
            And CONTRACT.ID_RESOURCE = CAPS_RESOURCE.ID_RESOURCE
            And DELVRD_SVC_DTL_ADJ.ID_INVOICE = INVOICE_ADJ.ID_INVOICE
            And PERSON_CLIENT.ID_PERSON = DELVRD_SVC_DTL_ADJ.ID_SVC_DTL_PERSON
 And INVOICE_ADJ.CD_INVO_GENERATION = 'S'
 And INVOICE_ADJ.DT_INVO_CREATE_DATE >= to_date($dt_generation_from, 'mm/dd/yyyy')
 And INVOICE_ADJ.DT_INVO_CREATE_DATE < to_date($dt_generation_to, 'mm/dd/yyyy') + 1
 And [$where_clause_optional]
Order By (1)
,      (decode ( CCOUNT.DECODE, '-None-', '-Multi-County-',  CCOUNT.DECODE  ))
,      (PERSON_CLIENT.NM_PERSON_FULL || '           '  || PERSON_CLIENT.ID_PERSON)
,      INVOICE_ORG.NBR_INVO_WARRANT
,      INVOICE_ADJ.ID_ORIG_REVERSAL_INV
,      INVOICE_ADJ.ID_INVOICE
End-Select
 Next-Listing
 Next-Listing  Need=105
 If #1ROW_COUNT > 0
 Graphic (4,1,719) Horz-Line 20 
 Position (6,1)
 Graphic (107,2,719) Horz-Line 20 
 Position (109,1)
 let #report_invo_ID_cnt = #1ROW_COUNT
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
  Print #report_invo_ID_cnt (26,209) Bold  Edit 99999999na
  Print 'Report Summary'  (26,1) Underline  Bold 
  Print 'Number of Invoices: '  (26,112) Underline  Bold 
  Print 'Number of Clients: '  (26,357) Underline  Bold 
  Print 'Rerate Invoice Counts:'  (52,1) Underline  Bold 
   Let #report_rerate_cnt=#_rerate_cnt
 Print #report_rerate_cnt (52,133) Edit 99999 Bold 
  Print 'Recoupment Invoice Counts:'  (52,357) Underline  Bold 
   Let #report_recoup_cnt=#_recoup_cnt
 Print #report_recoup_cnt (52,503) Edit 99999 Bold 
   Let #report_rerate_positive_cnt=#_rerate_positive_cnt
 Print #report_rerate_positive_cnt (72,134) Edit 99999
  Print 'Negative Invoice Counts:'  (88,13) Bold 
  Print 'Negative Invoice Counts:'  (88,379) Bold 
  Print 'Positive Invoice Total:'  (72,174) Bold 
  Print 'Negative Invoice Total:'  (88,174) Bold 
  Print 'Positive Invoice Total:'  (72,545) Bold 
  Print 'Negative Invoice Total:'  (88,544) Bold 
   Let #report_recoup_negative_cnt=#_recoup_negative_cnt
 Print #report_recoup_negative_cnt (88,504) Edit 99999
   Let #report_recoup_positive_cnt=#_recoup_positive_cnt
 Print #report_recoup_positive_cnt (72,504) Edit 99999
   Let #report_recoup_negative_total=#_recoup_negative_total
 Print #report_recoup_negative_total (88,654) Edit 9999999999.99
   Let #report_recoup_positive_total=#_recoup_positive_total
 Print #report_recoup_positive_total (72,654) Edit 9999999999.99
   Let #report_rerate_negative_cnt=#_rerate_negative_cnt
 Print #report_rerate_negative_cnt (88,134) Edit 99999
   Let #report_rerate_positive_total=#_rerate_positive_total
 Print #report_rerate_positive_total (72,284) Edit 9999999999.99
   Let #report_rerate_negative_total=#_rerate_negative_total
 Print #report_rerate_negative_total (88,284) Edit 9999999999.99
   Let #report_client_cnt_disp=#report_client_cnt
 Print #report_client_cnt_disp (26,452) Edit 999999 Bold 
  Print 'Positive Invoice Counts:'  (72,13) Bold 
  Print 'Positive Invoice Counts:'  (72,379) Bold 
 End-If
 Next-Listing
!  Place the closing tag(s) into the XML file
   Write 1 from '<output>'
   Write 1 from '</output>'
   Close 1
End-Procedure

Begin-Procedure Master_Querycounty_header_BeforeProc102
 Move 0 to #cnty_client_cnt
 Next-Listing  Need=22
 Graphic (1,1,719) Horz-Line 20 
 Position (3,1)
  Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print &county_header (21,1,30) Bold  Wrap 30 9 line-height=12 Keep-Top
   Position (+12,)
 Next-Listing  Need=49
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
End-Procedure

Begin-Procedure Master_Querycounty_header_AfterProc102
 Next-Listing  Need=21
 Graphic (2,1,719) Horz-Line 20 
 Position (4,1)
 let #cnty_invo_ID_cnt = #102ROW_COUNT
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print #cnty_invo_ID_cnt (21,209) Bold  Edit 99999999na
 Print 'Number of Clients: '  (21,292) Bold 
 Print 'Number of Invoices: '  (21,112) Bold 
  Let $cnty_summary_label=$prev_cnty || ' Summary'
 Print $cnty_summary_label (21,1,20) Bold 
  Let #cnty_client_cnt_disp=#cnty_client_cnt
 Print #cnty_client_cnt_disp (21,386) Edit 999999 Bold 
   Position (+12,)
 Move 0 To #102ROW_COUNT
 Next-Listing  Need=49
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
End-Procedure

Begin-Procedure Master_Queryclient_name_ID_BeforeProc103
Add 1 to #cnty_client_cnt
Add 1 to #report_client_cnt
 Next-Listing  Need=18
 Graphic (1,1,719) Horz-Line 15 
 Position (2,1)
  Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print &client_name_ID (18,82,51) Bold 
 Print 'Client Name/ID:'  (18,1) Bold 
   Position (+12,)
 Next-Listing  Need=49
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
End-Procedure

Begin-Procedure Master_Queryclient_name_ID_AfterProc103
 Next-Listing  Need=18
 Graphic (3,48,672) Horz-Line 10 
 Position (4,1)
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print 'Client Number of Invoices:'  (18,50) Bold 
 let #invo_ID_client_cnt = #103ROW_COUNT
 Print #invo_ID_client_cnt (18,160) Bold  Edit 99999999na
   Position (+12,)
 Move 0 To #103ROW_COUNT
 Next-Listing  Need=49
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
End-Procedure

Begin-Procedure Line_Item (#P1_ID_INVOICE)
 Move 0 To #_2ROW_COUNT
Begin-Select
(DELVRD_SVC_DTL.AMT_SVC_DTL_UNIT_RATE *  DELVRD_SVC_DTL.NBR_SVC_DTL_UNIT_QTY) &_item_total
ID_INVOICE &_Line_Item_ID_INVOICE
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
MO_SVC_DTL_SVC_MONTH &_Line_Item_MO_SVC_DTL_SVC_MONTH (12,105) Edit 99na
YR_SVC_DTL_SVC_YEAR &_Line_Item_YR_SVC_DTL_SVC_YEAR (12,142) Edit 9999na
 Print &_item_total (13,650) Edit 99999.99na
DECODE &_Line_Item_DECODE (13,269,71)
NBR_SVC_DTL_TO_DAY &_Line_Item_NBR_SVC_DTL_TO_DAY (13,228) Edit 999na
NBR_SVC_DTL_FROM_DAY &_Line_Item_NBR_SVC_DTL_FROM_DAY (13,187) Edit 999na
 Add 1 To #_2ROW_COUNT
 Next-Listing  Need=13
From  DELVRD_SVC_DTL, CSVCCODE
      Where DELVRD_SVC_DTL.CD_SVC_DTL_SERVICE = CSVCCODE.CODE
 And ID_INVOICE = #P1_ID_INVOICE
End-Select
 Next-Listing
 Next-Listing  Need=12
 If #_2ROW_COUNT > 0
 Alter-Printer Font=4 Point-Size=8    ! [SQR.INI] 4=Arial,proportional
  Print '    '  (12,1)
 End-If
 Next-Listing
End-Procedure

Begin-Procedure CreateXML_ManifestFile
! Open the XML file.
 Let $_XML_Var='SQROutput.xml'
 Open $_XML_Var as 1 for-writing record=32767:vary
! Place the elements of the DTD.
 Let $preamble = '<?xml version="1.0" encoding="ISO-8859-1"?>'
 Write 1 from $preamble
End-Procedure

Begin-Heading 48 
 do HeadingProcedure
End-Heading

Begin-Procedure HeadingProcedure
 Alter-Printer Font=4 Point-Size=10

 If #page-count <= 1
  Position (1,1)
 Print-Image (1,1)
	Type=bmp-file
	Source='D:\Documents and Settings\hong-van.t.vo\My Documents\Reports Data\SHINES.bmp'
	Image-size=(102,73)
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print 'Division of Family and Children Services' (17,251,40)
 Alter-Printer Font=4 Point-Size=14    ! [SQR.INI] 4=Arial,proportional
 Print 'Prior Period Adjustment Invoice Details' (49,198,39) Bold 
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Print 'Produced On:' (17,599,0)
 Print $current-date (17,664) edit 'MM/DD/YYYY'
 Print 'Generation Date From:' (93,1,21) Bold 
 Print 'Generation Date To:' (108,1,20) Bold 
 Print 'Region:' (93,205,10) Bold 
 Print 'County:' (108,205,10) Bold 
 Print 'Resource ID:' (108,360,15) Bold 
 Print 'Invoice Type:' (93,525,15) Bold 
 Print 'Invoice Phase:' (108,525,15) Bold 
 Let $dt_generation_from=$dt_generation_from
 Print $dt_generation_from (93,115,10)
 Let $dt_generation_to=$dt_generation_to
 Print $dt_generation_to (108,115,10)
 Let $region=$region
 Print $region (93,248,3)
 Let $county=$county
 Print $county (108,248,15)
 Print 'Client ID:' (93,360,15) Bold 
 Let $resource=$resource
 Print $resource (108,424,16)
 Let $client=$client
 Print $client (93,424,15)
 Let $type=$type
 Print $type (93,599,25)
 Let $phase=$phase
 Print $phase (108,599,25)
 Let $adj=$adj
 Print $adj (67,303,20) Bold 
 Print 'Invoice$ID' (133,50,7) Underline  Bold  Wrap 7 2 line-height=12 Keep-Top on=$
 Print 'Type' (133,103,0) Underline  Bold 
 Print 'Phase' (133,130,0) Underline  Bold 
 Print 'Resource$ID' (133,172,8) Underline  Bold  Wrap 8 2 line-height=12 Keep-Top on=$
 Print 'Resource$Name' (133,224,8) Underline  Bold  Wrap 8 2 line-height=12 Keep-Top on=$
 Print 'Vendor$ID' (133,344,6) Underline  Bold  Wrap 6 2 line-height=12 Keep-Top on=$
 Print 'Submitted$Date' (133,386,10) Underline  Bold  Wrap 10 2 line-height=12 Keep-Top on=$
 Print 'Original$Check$Date' (133,500,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 Print 'Original$Invoice$ID' (133,443,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 Print 'Aprvl$Status' (133,652,6) Underline  Bold  Wrap 6 2 line-height=12 Keep-Top on=$
 Print 'Invoice$Specific$Adj.' (133,693,10) Underline  Bold  Wrap 10 3 line-height=12 Keep-Top on=$
 Print 'Original$Check$Amount' (133,604,8) Underline  Bold  Wrap 8 3 line-height=12 Keep-Top on=$
 Print 'Original$Check$Number' (133,551,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 Else   ! put a non combined page header
 Print 'Invoice$ID' (10,50,7) Underline  Bold  Wrap 7 2 line-height=12 Keep-Top on=$
 Print 'Type' (10,103,0) Underline  Bold 
 Print 'Phase' (10,130,0) Underline  Bold 
 Print 'Resource$ID' (10,172,8) Underline  Bold  Wrap 8 2 line-height=12 Keep-Top on=$
 Print 'Resource$Name' (10,224,8) Underline  Bold  Wrap 8 2 line-height=12 Keep-Top on=$
 Print 'Vendor$ID' (10,344,6) Underline  Bold  Wrap 6 2 line-height=12 Keep-Top on=$
 Print 'Submitted$Date' (10,386,10) Underline  Bold  Wrap 10 2 line-height=12 Keep-Top on=$
 Print 'Original$Check$Date' (10,500,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 Print 'Original$Invoice$ID' (10,443,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 Print 'Aprvl$Status' (10,652,6) Underline  Bold  Wrap 6 2 line-height=12 Keep-Top on=$
 Print 'Invoice$Specific$Adj.' (10,693,10) Underline  Bold  Wrap 10 3 line-height=12 Keep-Top on=$
 Print 'Original$Check$Amount' (10,604,8) Underline  Bold  Wrap 8 3 line-height=12 Keep-Top on=$
 Print 'Original$Check$Number' (10,551,9) Underline  Bold  Wrap 9 3 line-height=12 Keep-Top on=$
 End-If
 Alter-Printer Font=4 Point-Size=10
End-Procedure
Begin-Footing 36 
 Alter-Printer Font=4 Point-Size=10    ! [SQR.INI] 4=Arial,proportional
 Last-Page (28,696) 
 Page-Number (28,669) '' ' of '
 Alter-Printer Font=4 Point-Size=10
End-Footing

